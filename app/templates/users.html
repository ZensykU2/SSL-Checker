<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Benutzer Verwaltung</title>
    <script>
      (function () {
        const theme = localStorage.getItem('theme');
        if (
          theme === 'dark' ||
          (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)
        ) {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
      };
    </script>
    <script src="/static/js/theme-toggle.js"></script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen flex">
  {% include "partials/sidebar.html" %}
  
  <main class="flex-1 p-8">
    <h1 class="text-2xl font-bold mb-6">Alle Benutzer</h1>
    <form method="get" action="/users" class="mb-4">
      <div class="flex gap-4 items-center">
        <label for="role" class="block text-lg font-medium mb-1">Filtern</label>
        <select name="role" id="role" class="p-2 rounded bg-gray-200 dark:bg-gray-700 dark:text-white" onchange="this.form.submit()">
          <option value="">Alle</option>
          <option value="user" {% if request.query_params.role == "user" %} selected {% endif %}>User</option>
          <option value="admin" {% if request.query_params.role == "admin" %} selected {% endif %}>Admin</option>
        </select>
        <a href="/users" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded transition">
          Zurücksetzen
        </a>
      </div>
    </form>

    {% if error %}
        <div class="mb-4 p-4 bg-red-100 text-red-800 rounded">
            {{ error }}
        </div>
    {% endif %}
    {% if success %}
    <div class="mb-4 p-4 bg-green-100 text-green-800 rounded">
        {{ success }}
    </div>
    {% endif %}
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white dark:bg-gray-800 rounded shadow-md">
        <thead>
          <tr class="bg-gray-200 dark:bg-gray-700 text-left text-sm font-semibold">
            <th class="px-4 py-3">Benutzername</th>
            <th class="px-4 py-3">E-Mail</th>
            <th class="px-4 py-3">Rolle</th>
            <th class="px-4 py-3">Aktionen</th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
          <tr class="border-t border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition">
            <td class="px-4 py-2">{{ user.username }}</td>
            <td class="px-4 py-2">{{ user.email }}</td>
            <td class="px-4 py-2">{{ 'Admin' if user.is_admin else 'User' }}</td>
            <td class="px-4 py-2 flex gap-2">
              <form method="post" action="/users/toggle-admin/{{ user.id }}">
                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded transition">
                  {{ 'Zu User' if user.is_admin else 'Zu Admin' }}
                </button>
              </form>
              <button onclick="openDeleteModal('{{ user.id }}')"
                      class="bg-red-600 hover:bg-red-700 text-white text-sm px-4 py-2 rounded transition">
                Löschen
              </button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </main>

  <div id="deleteModal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white dark:bg-gray-800 p-6 rounded shadow-md w-full max-w-sm">
      <h2 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Benutzer löschen</h2>
      <p class="text-sm text-gray-700 dark:text-gray-300 mb-6">Bist du sicher, dass du diesen Benutzer löschen möchtest?</p>
      <div class="flex justify-end gap-3">
        <button onclick="closeDeleteModal()" class="px-4 py-2 rounded bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 dark:hover:bg-gray-500 text-sm">
          Abbrechen
        </button>
        <form id="deleteUserForm" method="post" action="">
          <button type="submit" class="px-4 py-2 rounded bg-red-600 hover:bg-red-700 text-white text-sm">
            Löschen
          </button>
        </form>
      </div>
    </div>
  </div>

  <script src="/static/js/modals.js"></script>
</body>
</html>
